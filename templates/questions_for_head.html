{% extends "layout.html" %}

{% block title %}
Questions
{% endblock %}

{% block main %}
<body>
    <style>
    div {
    text-align: left;
    margin-top: 20px
    }
    p {
    margin-top: 0px;
    margin-bottom: 0px;
    text-align: justify;
    font-size: 150%;
    }
    </style>
</body>


<div style="width: 95%; margin: auto; text-align: left; margin-bottom: 30px;">
    <p>Итак, внимательно ознакомьтесь с описанием каждой компетенции. Посмотрите, по каким шкалам проводится оценка. Подумайте, насколько поведение, описанное в каждой компетенции, важно для достижения результатов работы в каждой должности сотрудников, которыми Вы руководите.</p>
    <p>Выберите приоритеты по каждой компетенции, чтобы создать идеальный профиль для каждой должности сотрудников, которые работают под Вашим руководством.</p>
    <p style="margin-top: 25px;">Распределите приоритеты от 1 до 9, где 1 – самый высокий приоритет (компетенция крайне важна для хорошей работы сотрудника на занимаемой должности, 9 – самый низкий приоритет (компетенция может быть развита плохо и это не влияет на качество работы сотрудника в данной должности) </p>
</div>
<table class="table table-striped" style="width: 95%; text-align: left;">
<thead>
    <tr>
        <th colspan="3"><h4>Вам неоходимо создать профиль компетенций для должностей:{% for positition in  allPositionFromList %}  {{ positition.1 }}; {% endfor %} </h4></th> </tr>
    <tr>
        <th colspan="3"><h4 style="margin-bottom: 20px; color: rgb(14, 20, 130);">Должность - {{ positionFromList.0.1 }}</h2></th>
    </tr>
    <tr>
        <th>Компетенция</th>
        <th>Описание компетенции</th>
        <th>Приоритет</th>
    </tr>
</thead>
<tbody> <form action="/users" method="post" name="users">
    <input type="hidden" name="position_pos" value="{{ positionFromList.0.1 }}" >
     {% for comp in competence %}       
      <tr>   
        <td>{{ comp.0 }}</td>
        <td>{{ comp.1 }}</td>
        <td>
            <select name="comp_{{ loop.index}}" id="id_{{loop.index}}" required onchange='too_function()'>
            <option disabled selected></option>
            <option id="op_1{{ comp.0 }}" value="1">1</option>
            <option id="op_2{{ comp.0 }}" value="2">2</option>
            <option id="op_3{{ comp.0 }}" value="3">3</option>
            <option id="op_4{{ comp.0 }}" value="4">4</option>
            <option id="op_5{{ comp.0 }}" value="5">5</option>
            <option id="op_6{{ comp.0 }}" value="6">6</option>
            <option id="op_7{{ comp.0 }}" value="7">7</option>
            <option id="op_8{{ comp.0 }}" value="8">8</option>
            <option id="op_9{{ comp.0 }}" value="9">9</option>
            </select>
        </td> 
    </tr>{%endfor%}

    <caption>
        <button class="btn btn-primary"  type="" onclick="return reset_selector('Отменить изменения?')">Изменить значения</button>
        <button class="btn btn-primary" type="submit" id="button" onclick="return check()">Нажмите здесь, чтобы перейти к следующей должности</button>
    </caption>

</form>
</tbody>
</table> 


<script>

    function too_function (){
        hyd();
        check()
    }
    
    function  hyd(){
        let id = new Array(10);
        let name = new Array('Надежность', 'Организованноcть', 'Стремление к совершенству',  'Приверженность', 'Командность', 'Ориентация на клиента', 'Принятие решений', 'Эффективная коммуникация',  'Управленческое мастерство')
        let o_id = new Array(10);
        let arr = new Array(0,1,2,3,4,5,6,7,8,9,10)
        let opt = new Array(10);
        for(let i = 1; i < 10; i++){    
            id[i] = 'id_' + i;    
            opt[i] = document.getElementById(id[i]).value;   
        }
        let l = opt.length;
        let c = 1;
        while (c < l) {
            for (let b = 1; b < l; b++){
                if (opt[c] == arr[b]){
                    console.log(opt[c], arr[b])
                    for (let n = 0; n < 9; n++){
                        let x = 'op_' + b + name[n];
                        //document.getElementById(x).style.display = "none"
                        document.getElementById(x).disabled = true
                    }
                }  
            } 
            c ++;
        }
        return true;
    }

    function reset_selector()
    {
        let id = new Array(10);
        let name = new Array('Надежность', 'Организованноcть', 'Стремление к совершенству',  'Приверженность', 'Командность', 'Ориентация на клиента', 'Принятие решений', 'Эффективная коммуникация',  'Управленческое мастерство')
        let o_id = new Array(10);
        let arr = new Array(0,1,2,3,4,5,6,7,8,9,10)
        let opt = new Array(10);
        for(let i = 1; i < 10; i++){    
            id[i] = 'id_' + i;    
            opt[i] = document.getElementById(id[i]).value;   
        }
        let l = opt.length;
        let c = 1;
        while (c < l) {
            for (let b = 1; b < l; b++){        
                for (let n = 0; n < 9; n++){
                    let x = 'op_' + b + name[n];
                    //document.getElementById(x).style.display = "none"
                    document.getElementById(x).disabled = false
                }
            } 
            c ++;
        }  
        return false;
    }


    function check() {
        let id = new Array(10);
        let opt = new Array(10);
        for(let i = 1; i < 10; i++){
            id[i] = 'id_' + i;    
            opt[i] = document.getElementById(id[i]).value;
        } 
        let l = opt.length;
        let c = 1;
        while (c < l) {
            for (let b = 1; b < l; b++){
                if (opt[c] === opt[b] && b != c && opt[c] != 0 ){
                    alert('Значение должно быть уникальным');
                    document.getElementById(id[b]).style.border = "1px solid red";
                    document.getElementById(id[c]).style.border = "1px solid red";
                    return false;
                    break;
                }
                else {
                    document.getElementById(id[b]).style.border = "1px solid black";
                    document.getElementById(id[c]).style.border = "1px solid black";
                }
            } 
            c ++;
        }   
        return true;
    }

    </script>

    {% endblock %}
